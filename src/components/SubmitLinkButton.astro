---
import { getLocaleFromAstro, t, clientTranslations } from '../i18n/locales';
import { COLORS } from '../utils/constants';

// 使用安全函数获取语言，避免在预渲染模式下访问 Astro.request
const locale = getLocaleFromAstro();
const href = 'https://github.com/zhycn/official-ai/issues';
---

<a
    href={href}
    target="_blank"
    rel="noopener noreferrer"
    class="submit-link-btn btn-primary px-4 py-2.5 min-w-[100px] text-center text-sm font-medium text-white rounded-lg transition-colors duration-200 touch-manipulation shadow-sm hover:shadow-md"
>
    <span id="submit-link-text">{t('nav.submit', locale)}</span>
</a>

<script define:vars={{ clientTranslations }}>
    // ==================== 客户端 i18n 工具函数（内联版本）====================
    
    // 获取当前语言（客户端）
    function getClientLocale() {
      if (typeof window === 'undefined') return 'zh';
      try {
        const saved = localStorage.getItem('locale');
        if (saved === 'zh' || saved === 'en') {
          return saved;
        }
        const cookies = document.cookie.split(';').reduce((acc, cookie) => {
          const [key, value] = cookie.trim().split('=');
          if (key) {
            try {
              acc[decodeURIComponent(key)] = decodeURIComponent(value || '');
            } catch (e) {
              acc[key] = value || '';
            }
          }
          return acc;
        }, {});
        if (cookies.locale === 'zh' || cookies.locale === 'en') {
          localStorage.setItem('locale', cookies.locale);
          return cookies.locale;
        }
        const browserLang = navigator.language || navigator.userLanguage || '';
        if (browserLang.startsWith('zh')) return 'zh';
        if (browserLang.startsWith('en')) return 'en';
      } catch (e) {
      }
      return 'zh';
    }
    
    // 更新提交链接文本
    function updateSubmitLinkText(locale) {
      const nav = clientTranslations[locale]?.nav || clientTranslations['zh'].nav;
      
      const submitLinkTextEl = document.getElementById('submit-link-text');

      if (submitLinkTextEl) submitLinkTextEl.textContent = nav.submit;
    }
    
    // 监听语言变更事件
    window.addEventListener('localechange', function(e) {
      const locale = (e.detail && e.detail.locale) ? e.detail.locale : getClientLocale();
      updateSubmitLinkText(locale);
    });
    
    // 初始化时更新文本（处理客户端渲染）
    if (typeof window !== 'undefined') {
      updateSubmitLinkText(getClientLocale());
    }
  </script>
  