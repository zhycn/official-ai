---
// 语言切换组件
---

<div class="relative">
  <button
    id="language-toggle"
    type="button"
    class="px-3 py-1.5 rounded-lg text-sm font-medium text-gray-600 dark:text-gray-300 bg-gray-50 dark:bg-gray-800/50 border border-gray-200 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 transition-all duration-200 hover:scale-105 active:scale-95"
    aria-label="切换语言"
    title="切换语言：中文 / English"
  >
    <span id="language-display">ZH</span>
  </button>
</div>

<script is:inline>
  (function() {
    const locales = {
      zh: '中文',
      en: 'EN'
    };
    
    // 获取当前语言
    function getLocale() {
      return localStorage.getItem('locale') || 'zh';
    }
    
    // 设置语言
    function setLocale(locale) {
      localStorage.setItem('locale', locale);
      updateLanguageDisplay(locale);
      
      // 触发语言变更事件
      window.dispatchEvent(new CustomEvent('localechange', { 
        detail: { locale: locale } 
      }));
      
      // 更新页面文本（不刷新页面）
      updatePageText(locale);
    }
    
    // 更新页面文本
    function updatePageText(locale) {
      const translations = {
        zh: {
          login: '登录',
          page: '页',
          prev: '上一页',
          next: '下一页',
          stats: '已收录',
          items: '项',
          title: 'Skills',
          version: 'online v0.1.0',
          copyright: '© 2025 skill0',
          builtBy: 'Built by atypica.ai'
        },
        en: {
          login: 'Sign In',
          page: 'Page',
          prev: 'Previous',
          next: 'Next',
          stats: 'Collected',
          items: 'items',
          title: 'Skills',
          version: 'online v0.1.0',
          copyright: '© 2025 skill0',
          builtBy: 'Built by atypica.ai'
        }
      };
      
      const t = translations[locale] || translations.zh;
      
      // 更新登录按钮
      const loginBtn = document.querySelector('[data-i18n="nav.login"]');
      if (loginBtn) loginBtn.textContent = t.login;
      
      // 更新标题（如果需要）
      const title = document.querySelector('h1');
      if (title && title.textContent === 'Skills') {
        title.textContent = t.title;
      }
      
      // 更新统计信息
      const statsText = document.getElementById('stats-text');
      if (statsText) {
        const totalCount = document.getElementById('total-count')?.textContent || '0';
        statsText.innerHTML = `${t.stats} · <span id="total-count" class="font-semibold text-gray-900 dark:text-white">${totalCount}</span> ${t.items}`;
      }
      
      // 更新分页文本
      const pageInfo = document.querySelector('#pagination-container .text-sm');
      if (pageInfo) {
        const match = pageInfo.textContent.match(/(\d+)\s*\/\s*(\d+)/);
        if (match) {
          pageInfo.innerHTML = `${t.page} <span class="text-gray-900 dark:text-white">${match[1]}</span> / <span class="text-gray-900 dark:text-white">${match[2]}</span>`;
        }
      }
      
      const prevBtn = document.getElementById('prev-page');
      if (prevBtn) prevBtn.textContent = t.prev;
      
      const nextBtn = document.getElementById('next-page');
      if (nextBtn) nextBtn.textContent = t.next;
      
      // 更新搜索框占位符
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.placeholder = locale === 'zh' ? '搜索工具...' : 'Search tools...';
      }
      
      // 更新清除按钮
      const clearBtn = document.getElementById('search-clear');
      if (clearBtn) {
        clearBtn.setAttribute('aria-label', locale === 'zh' ? '清除搜索' : 'Clear search');
      }
    }
    
    // 更新语言显示
    function updateLanguageDisplay(locale) {
      const display = document.getElementById('language-display');
      if (display) {
        display.textContent = locale === 'zh' ? 'ZH' : 'EN';
      }
    }
    
    // 切换语言
    function toggleLanguage() {
      const currentLocale = getLocale();
      const nextLocale = currentLocale === 'zh' ? 'en' : 'zh';
      setLocale(nextLocale);
    }
    
    // 初始化
    function initLanguageToggle() {
      const languageToggle = document.getElementById('language-toggle');
      
      if (!languageToggle) {
        setTimeout(initLanguageToggle, 100);
        return;
      }
      
      // 显示当前语言
      updateLanguageDisplay(getLocale());
      
      // 绑定点击事件
      languageToggle.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        toggleLanguage();
      });
    }
    
    // 确保在 DOM 加载后执行
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', function() {
        setTimeout(initLanguageToggle, 50);
      });
    } else {
      setTimeout(initLanguageToggle, 50);
    }
  })();
</script>
